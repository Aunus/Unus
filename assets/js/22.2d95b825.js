(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{346:function(e,a,t){"use strict";t.r(a);var r=t(0),s=Object(r.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"docker学习笔记"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker学习笔记"}},[e._v("#")]),e._v(" Docker学习笔记")]),e._v(" "),t("h2",{attrs:{id:"相关概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相关概念"}},[e._v("#")]),e._v(" 相关概念")]),e._v(" "),t("h3",{attrs:{id:"需求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[e._v("#")]),e._v(" 需求")]),e._v(" "),t("ul",[t("li",[e._v("环境配置麻烦的问题")]),e._v(" "),t("li",[e._v("虚拟机：资源占用多、冗余步骤多、启动慢（虚拟机是完整的操作系统）")])]),e._v(" "),t("h3",{attrs:{id:"linux-容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linux-容器"}},[e._v("#")]),e._v(" linux 容器")]),e._v(" "),t("p",[e._v("Linux 容器（Linux Containers，缩写为 LXC）不是模拟一个完整的操作系统，而是对进程进行隔离。")]),e._v(" "),t("p",[e._v("优势：进程级别，资源占用低，体积小，启动快，多个容器可以共享资源。")]),e._v(" "),t("h2",{attrs:{id:"docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[e._v("#")]),e._v(" Docker")]),e._v(" "),t("p",[t("strong",[e._v("Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。")]),e._v("\nDocker 通过将程序及程序依赖包or文件打包成一个文件，即为image文件。运行image文件，生成一个容器（底层系统的一个进程）。")]),e._v(" "),t("p",[e._v("每个容器之间相互隔离（内存空间、硬盘空间、线程、网络地址等等），共用部分系统资源。")]),e._v(" "),t("h3",{attrs:{id:"image-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#image-文件"}},[e._v("#")]),e._v(" image 文件")]),e._v(" "),t("ul",[t("li",[e._v("二进制文件，包含程序代码及其依赖")]),e._v(" "),t("li",[e._v("通用，可以看做是容器的模板")]),e._v(" "),t("li",[e._v("同一个image可以生成多个容器且同时运行")])]),e._v(" "),t("h3",{attrs:{id:"container-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#container-文件"}},[e._v("#")]),e._v(" container 文件")]),e._v(" "),t("p",[t("strong",[e._v("image 文件生成的容器实例，本身也是一个文件，称为容器文件。")])]),e._v(" "),t("blockquote",[t("p",[e._v("一旦容器生成，会生成容器文件，且容器文件不会随容器停止而删除。")])]),e._v(" "),t("h3",{attrs:{id:"dockerfile-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-文件"}},[e._v("#")]),e._v(" Dockerfile 文件")]),e._v(" "),t("p",[e._v("Dockerfile文件，用来配置image，docker根据Dockerfile创建image文件。")]),e._v(" "),t("h2",{attrs:{id:"编写dockerfile文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写dockerfile文件"}},[e._v("#")]),e._v(" 编写Dockerfile文件")]),e._v(" "),t("blockquote",[t("p",[e._v("以python web项目为例")])]),e._v(" "),t("h3",{attrs:{id:"_1-根目录创建-dockerignore文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-根目录创建-dockerignore文件"}},[e._v("#")]),e._v(" 1.根目录创建 .dockerignore文件")]),e._v(" "),t("p",[e._v("表示打包成image时忽略的文件或者文件夹")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v(".git\n*.log\n")])])]),t("h3",{attrs:{id:"_2-生成python依赖包文件requirements-txt"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-生成python依赖包文件requirements-txt"}},[e._v("#")]),e._v(" 2.生成python依赖包文件requirements.txt")]),e._v(" "),t("p",[t("code",[e._v("pipenv lock --requirements > requirements.txt")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("prs-utility==0.0.4\nbottle==0.12.16\nurllib3==1.23\n")])])]),t("h3",{attrs:{id:"_3-编写dockerfile文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-编写dockerfile文件"}},[e._v("#")]),e._v(" 3.编写Dockerfile文件")]),e._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('\n# python 环境 alpine版本为体积最小版本\nFROM python:3.7-alpine \n\n# 将工作目录设置为 /press\nWORKDIR /press\n\n# 将当前目录内容复制到位于 /press 中的容器中\nADD . /press\n\n# 按照 依赖环境到临时的虚拟包\n# 安装 requirements.txt 中指定的任何所需软件包\n# 删除缓存文件和虚拟包\nRUN apk add --no-cache --virtual .pynacl_deps build-base python3-dev libffi-dev \\\n     && pip install -r requirements.txt \\\n     && rm -rf .cache/pip \\\n     && apk del .pynacl_deps\n\n# 定义环境变量\nENV  profile=test\n# 定义语言环境\nENV LANG=en_US.UTF-8\n\n#将容器 8112 端口暴露出来， 允许外部连接这个端口。\nEXPOSE 8112\n\n# 在容器启动时运行 press_web.py\nCMD ["python3", "press_web.py"]\n\n')])])]),t("h3",{attrs:{id:"_4-生成docker-image文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-生成docker-image文件"}},[e._v("#")]),e._v(" 4.生成docker image文件")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# docker image build -t <image_name>:<image_version> <Dockerfile 所在文件夹名称>\ndocker image build -t press .\n")])])]),t("h3",{attrs:{id:"_5-运行container"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-运行container"}},[e._v("#")]),e._v(" 5.运行container")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker container run --env profile=test --rm -p 8112:8112 -it press\n\n\ndocker container run --env profile=prod --rm -p 8112:8112 -it press\n")])])]),t("h3",{attrs:{id:"_6-发布image-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-发布image-文件"}},[e._v("#")]),e._v(" 6.发布image 文件")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# 先登录\ndocker login\n\n# 为本地image 标注用户名和版本。\ndocker image tag [imageName] [username]/[repository]:[tag]\n# 实例\ndocker image tag press:latest zoex/press:latest\n\ndocker image push zoex/press:latest\n\n\n\n")])])]),t("h3",{attrs:{id:"_6-获取image"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-获取image"}},[e._v("#")]),e._v(" 6. 获取image")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 先登录")]),e._v("\ndocker login\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 后pull")]),e._v("\ndocker pull zoex/press:latest\n")])])]),t("h2",{attrs:{id:"参考文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[e._v("#")]),e._v(" 参考文档")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 入门教程"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=s.exports}}]);